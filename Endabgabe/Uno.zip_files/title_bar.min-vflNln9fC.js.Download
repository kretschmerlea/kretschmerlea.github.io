define(["require","exports","tslib","react","external/classnames","external/react-redux","modules/clean/previews/data/actions","modules/clean/previews/util","modules/core/browser","modules/clean/react/css_timing","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/title_bar/base","modules/clean/react/title_bar/controls_container","modules/clean/react/file_viewer/title_name","file-viewer/core","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/api","modules/core/i18n","spectrum/button","spectrum/popover","modules/clean/react/snackbar","modules/clean/browse_uri_interface","modules/clean/react/watermarking/utils"],function(e,t,a,r,i,l,n,o,s,c,p,u,m,d,f,h,w,v,k,_,g,C,y,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),i=a.__importDefault(i),o=a.__importStar(o),s=a.__importStar(s);var b=k.i18n_default_project("watermarking")._;t.ApplyWatermarkButton=function(e){return r.default.createElement(g.Popover,{onSelection:e.onApply},r.default.createElement(g.PopoverTrigger,null,r.default.createElement(_.Button,{tagName:"span",variant:"primary",onClick:e.onClick},b("Apply Watermark")+"  ▾")),r.default.createElement(g.PopoverContent,null,r.default.createElement(g.PopoverContentItem,{value:!1,className:"apply-watermark-menu-item__copy"},b("Save as copy",{project:"web",comment:"As in: save the watermarked file as a copy"})),r.default.createElement(g.PopoverContentItem,{value:!0,className:"apply-watermark-menu-item__overwrite"},b("Overwrite this file",{project:"web",comment:"As in: overwrite this file with watermarked file"}))))};var B=(function(e){function l(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleApply=function(e){return a.__awaiter(t,void 0,void 0,function(){var t,i;return a.__generator(this,function(a){switch(a.label){case 0:C.Snackbar.sync(b("Watermarking file...",{project:"watermarking"})),u.logUserAction(e?p.UserAction.WatermarkApplyOverwrite:p.UserAction.WatermarkApplySaveAsCopy,p.UserActionContext.TitleBarMain),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,v.sendWatermarkRequest(this.props.user.id,this.props.file.file_id,{text:A.getDefaultText(this.props.user)},e)];case 2:return t=a.sent(),e?(this.props.applyVirtualPreviewMetadata(this.props.file),C.Snackbar.update(r.default.createElement(C.Snackbar,{variant:"complete",title:b("Watermark applied. To review, go to the file’s version history.",{project:"watermarking"}),actionButtonText:b("Version history",{project:"watermarking"}),onActionClick:this.handleVersionHistoryClick,closeButtonText:b("Close",{project:"watermarking"})}))):t.fq_path?s.replace_location(y.preview_uri_for_fq_path(this.props.user,t.fq_path)):C.Snackbar.update(r.default.createElement(C.Snackbar,{variant:"complete",title:b("We saved a watermarked copy of this file.",{project:"watermarking"}),closeButtonText:b("Close",{project:"watermarking"})})),this.props.clearVirtualPreviewMetadata(),this.props.changeMode(h.FileViewerMode.Default),[3,4];case 3:return i=a.sent(),C.Snackbar.fail(b("Couldn’t apply the watermark to the file. Please reload the page and try again.",{project:"watermarking"})),[3,4];case 4:return[2]}})})},t.handleCancel=function(){u.logUserAction(p.UserAction.WatermarkCancel,p.UserActionContext.TitleBarSecondaryButton),t.props.changeMode(h.FileViewerMode.Default),t.props.clearVirtualPreviewMetadata()},t.handleClose=function(){u.logUserAction(p.UserAction.WatermarkCancel,p.UserActionContext.TitleBarBackButton),t.props.changeMode(h.FileViewerMode.Default),t.props.clearVirtualPreviewMetadata()},t.handleVersionHistoryClick=function(){if(!t.props.user)throw new Error("User not specified");o.redirectToVersionHistory(t.props.file,t.props.user),u.logUserAction(p.UserAction.ViewRevisions,p.UserActionContext.WatermarkOverwriteNotice)},t.logApplyButtonClick=function(){u.logUserAction(p.UserAction.WatermarkOpenApplyMenu,p.UserActionContext.TitleBarMain)},t}return a.__extends(l,e),l.prototype.render=function(){var e=this.props,a=e.className,l=e.file,n=e.fileSubpath,o=e.hidePageChrome,s=e.isViewingFileSubpath,c=e.maxFilenameEmLength,p=e.sharedLinkInfo,u=e.sizeClass,h=e.user;return r.default.createElement(m.TitleBarBase,{canClose:!0,className:i.default("react-title-bar--dark",a),closeTitle:b("Back",{project:"watermarking"}),file:l,onClose:this.handleClose,shouldShowIcon:!s,sizeClass:u,title:r.default.createElement(f.TitleName,{file:l,fileSubpath:n,hidePageChrome:o,isViewingFileSubpath:s,maxFilenameEmLength:c,sharedLinkInfo:p,shouldDisplayStarred:!1,sizeClass:u,user:h}),controls:r.default.createElement(d.TitleBarControlsContainer,null,r.default.createElement("div",{className:"control__button"},r.default.createElement(t.ApplyWatermarkButton,{onApply:this.handleApply,onClick:this.logApplyButtonClick})),r.default.createElement("div",{className:"control__button"},r.default.createElement(_.Button,{variant:"secondary",onClick:this.handleCancel},b("Cancel",{project:"watermarking"}))))})},l})(r.default.Component);t._TitleBar=B;var M=l.connect(null,{changeMode:w.changeMode,clearVirtualPreviewMetadata:n.clearVirtualPreviewMetadata,setVirtualPreviewMetadata:n.setVirtualPreviewMetadata,applyVirtualPreviewMetadata:n.applyVirtualPreviewMetadata})(B),V=c.requireCssWithComponent(M,["/static/css/react_title_bar-vflUJIojz.css"]);t.TitleBar=V});
//# sourceMappingURL=title_bar.min.js-vfltFhbpF.map