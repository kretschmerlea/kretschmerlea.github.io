define(["require","exports","tslib","react","external/prop-types","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/em_string","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/react_format","modules/core/browser_detection","modules/core/user_i18n","modules/core/i18n","modules/clean/react/pass/upsell/tooltip/pass_upsell_tooltip","modules/clean/react/pass/upsell/simple_upsell","deep-integrations/platform/server/localization","modules/clean/react/pass/integration/profile_card_popover","external/react-redux","modules/clean/integrations/app_store_lite_modal","modules/clean/integrations/link_service","deep-integrations/profile_card/profile_card_tooltip_content","modules/clean/react/pass/tooltip_helpers","modules/clean/integrations/data/actions","deep-integrations/data/user_settings","modules/clean/integrations/profile_card_tooltip","modules/clean/integrations/data/store","modules/clean/integrations/data/selectors","deep-integrations/async"],function(t,e,o,r,n,a,i,l,s,p,u,c,d,f,h,g,m,v,_,C,I,E,b,y,T,A,x,S,P,U,w,O){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r=o.__importDefault(r),n=o.__importStar(n),a=o.__importDefault(a),s=o.__importDefault(s),h=o.__importStar(h),g=o.__importStar(g);var k=(function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.allowInteractingWithTooltip=function(){return!1},n.renderAvatarButton=function(){return r.default.createElement("button",{className:"pass-facepile-avatar"},n.getAvatar())},n.state={loadResult:"loaded"},n.onAvatarClick=n.onAvatarClick.bind(n),n}return o.__extends(e,t),e.prototype.onAvatarClick=function(){this.props.logPassEvent(u.EventTypes.PASS_CLICK)},e.prototype.getBubbleBackgroundColor=function(){},e.prototype.render=function(){var t=this.wrapAvatarWithTooltip(),e="pending"===this.state.loadResult?"react-pass__face-no-display":"react-pass__face-container";return r.default.createElement("div",{className:e},t)},e.prototype.wrapAvatarWithTooltip=function(){if(this.context.profileCardV2Enabled()){var t=this.context.getPopoverGroup(),e=this.props.tooltipCanInitiallyOpen&&this.context.shouldAutoDisplayTooltip();return r.default.createElement(t.popover,{upsellContent:this.getTooltipElement(),profileCard:this.getProfileCardElement(),positioning:"below",positionOffset:9,onClickTrigger:this.onAvatarClick,onMouseOverTrigger:this.props.onMouseEnter,isShowInitially:e},r.default.createElement("div",{className:"react-title-bubble__container"},this.renderAvatarButton()))}return r.default.createElement(d.TitleBubble,{content:this.getTooltipElement(),position:d.TitleBubble.POSITIONS.BOTTOM,distanceFromTarget:9,isTargetPositionFixed:!0,onMouseEnter:this.props.onMouseEnter,className:this.getTooltipClass(),backgroundColor:this.getBubbleBackgroundColor(),allowInteractTooltip:this.allowInteractingWithTooltip()},r.default.createElement("div",{onClick:this.onAvatarClick},this.renderAvatarButton()))},e.contextTypes={getPopoverGroup:n.func,profileCardV2Enabled:n.func,shouldAutoDisplayTooltip:n.func},e})(r.default.Component),M=(function(t){function e(e,o){var r=t.call(this,e,o)||this;return r.showAppStoreLiteModal=function(){r.context.getPopoverGroup().closePortal(),b.showAppStoreLiteModal(r.props.integrationInfo.userId)},r.connectService=function(t){r.context.getPopoverGroup().closePortal();var e=w.isConnectServiceLandingPagesEnabled(r.context.getIntegrationStore().getState());return y.linkService(r.props.integrationInfo.userId,t,e).then(function(){r.context.getIntegrationStore().dispatch(x.fetchListServices())})},r.allowInteractingWithTooltip=function(){return r.context.profileCardV2Enabled()||r.showPassUpsell},r.state={loadResult:null==r.props.userInfo.photoUrl?"loaded":"pending"},r.boundOnLoad=r.onFinalize.bind(r,!0),r.boundOnError=r.onFinalize.bind(r,!1),r}return o.__extends(e,t),Object.defineProperty(e.prototype,"showPassUpsell",{get:function(){return this.context.isInSimpleUpsellExperiment()&&_.shouldShowSimpleUpsellForAvatar(this.props.userInfo)&&!!this.props.upsellInfo&&this.props.upsellInfo.isViewerEligibleForUpsell},enumerable:!0,configurable:!0}),e.prototype.isGuestAvatar=function(){return this.props.userInfo.userId&&c.AnonymousViewerUtils.isAnonymousUserId(this.props.userInfo.userId)},e.prototype.getUserAvatarProps=function(){var t=this.props.userInfo,e=t.displayName,n=t.isActive,a=this.isGuestAvatar()?c.AnonymousViewerUtils.getAnonymousViewerInitials(e):g.getInitials(e),l={dimension:32,initials:a,color:this.getInitialsColor(),shape:"CIRCLE"};n||(l.optionalClass="c-avatar--inactive",h.msie&&(l.color="#7B8994"));var s=r.default.createElement(i.InitialsAvatar,o.__assign({},l));return n||(s=r.default.createElement("span",{className:"c-avatar-initials-wrapper"},s)),{alt:e,dimension:32,photoUrl:this.getEffectivePhotoUrl(),defaultAvatar:s,optionalClass:l.optionalClass,shape:"CIRCLE",onLoad:this.boundOnLoad,onError:this.boundOnError}},e.prototype.getEffectivePhotoUrl=function(){return"error"===this.state.loadResult?void 0:this.props.userInfo.photoUrl},e.prototype.getAvatar=function(){var t=this.getUserAvatarProps();return this.props.userInfo.isViewer&&"error"!==this.state.loadResult?r.default.createElement(s.default,o.__assign({},t)):r.default.createElement(a.default,o.__assign({},t))},e.prototype.onAvatarClick=function(){if(t.prototype.onAvatarClick.call(this),this.context.profileCardV2Enabled()){var e=this.context.getIntegrationStore(),o=["tooltip_click_for_more","tooltip_click_for_more_auto_display"].filter(function(t){return!U.isPromptDismissed(e.getState(),t)}).map(function(t){return{".tag":t}});o.length>0&&e.dispatch(S.dismissPrompts(o))}else this.props.openShareModal()},e.prototype.onFinalize=function(t){if(null!=this.getEffectivePhotoUrl()){this.setState({loadResult:t?"loaded":"error"});var e=this.props,o=e.userInfo.photoUrl,r=e.onLoad;r&&o&&r(o)}},e.prototype.getTooltipClass=function(){return this.context.profileCardV2Enabled()?"integration-tooltip-bubble":this.showPassUpsell?"seen-state-title-bubble-with-upsell":"seen-state-title-bubble"},e.prototype.getInitialsColor=function(){return this.isGuestAvatar()?l.colorValueForAvatarName(this.props.userInfo.userId):l.colorValueForAvatarName(this.props.userInfo.displayName)},e.prototype.getBubbleBackgroundColor=function(){return this.context.profileCardV2Enabled()?"transparent":this.getInitialsColor()},e.prototype.getTooltipElement=function(){var t=this.props.userInfo,e=p.Emstring.em_snippet(t.displayName,10);if(this.context.profileCardV2Enabled())return r.default.createElement(E.Provider,{store:this.context.getIntegrationStore()},r.default.createElement(P.StatefulProfileCardTooltipContent,{displayName:e,seenState:A.buildSeenStateMessage(t),avatarColor:this.getInitialsColor(),localization:C.localization}));if(this.showPassUpsell&&this.context.getTracker()&&this.context.getUpsellUrl()&&this.context.getVariant()&&this.props.upsellInfo)return r.default.createElement(v.PassUpsellTooltip,{displayName:e,baseColor:this.getInitialsColor(),tracker:this.context.getTracker(),info:this.props.upsellInfo,upsellUrl:this.context.getUpsellUrl(),variant:this.context.getVariant()});var o=void 0;o=A.buildSeenStateTemplate(t);var n=f.reactFormat(o,{user_name:e,b:r.default.createElement("b",{key:"thebold"}),newline:r.default.createElement("br",null)});return r.default.createElement("span",null,n)},e.prototype.getProfileCardElement=function(){var t=this.props,e=t.userInfo,o=t.integrationInfo;return r.default.createElement(E.Provider,{store:this.context.getIntegrationStore()},r.default.createElement(I.ProfileCardPopover,{userInfo:e,fileInfo:{".tag":"file",id:O.fulfilled(o.fileId),name:o.fileName},avatarColor:this.getInitialsColor(),onConnectService:this.connectService,onConnectServices:this.showAppStoreLiteModal,logEvent:this.context.logEvent(),performanceTimer:this.context.performanceTimer(),reportError:this.context.reportError()}))},e.contextTypes={getTracker:n.func,getUpsellUrl:n.func,getVariant:n.func,isInSimpleUpsellExperiment:n.func,getApiV2Client:n.func,getDataStore:n.func,getIntegrationStore:n.func,getPopoverGroup:n.func,profileCardV2Enabled:n.func,shouldAutoDisplayTooltip:n.func,performanceTimer:n.func,logEvent:n.func,reportError:n.func},e})(k);e.UserAvatar=M;var N=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.getTooltipMessage=function(){return m.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},e.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=u.MAX_OVERFLOW_BUTTON_INDICATOR?u.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},e.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=u.MAX_OVERFLOW_BUTTON_INDICATOR?u.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},e.prototype.getAvatar=function(){return r.default.createElement(i.InitialsAvatar,{alt:this.getMoreFacepileCountText(),dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},e.prototype.onAvatarClick=function(){t.prototype.onAvatarClick.call(this),this.props.openShareModal()},e.prototype.getTooltipClass=function(){return"seen-state-title-bubble facepile-overflow"},e.prototype.getTooltipElement=function(){return this.context.profileCardV2Enabled()?r.default.createElement(T.OverflowTooltipContent,{overflowMessage:this.getTooltipMessage()}):this.getTooltipMessage()},e.prototype.getProfileCardElement=function(){return null},e})(k);e.OverflowAvatar=N});
//# sourceMappingURL=avatars.min.js-vflY8MaBj.map