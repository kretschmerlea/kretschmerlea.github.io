define(["require","exports","tslib","react","modules/clean/filepath","modules/core/uri","modules/core/i18n","modules/clean/react/css","spectrum/popover","modules/clean/static_urls","modules/clean/react/file_viewer/open_button/types","modules/clean/react/app_actions/category","modules/clean/react/app_actions/redirect","modules/clean/react/sprite","spectrum/icon_action","spectrum/icon_document","modules/clean/react/file_viewer/unity/with_unity","modules/clean/react/file_viewer/constants","modules/clean/react/app_actions/byline","modules/clean/react/app_actions/redirect"],function(e,t,a,n,o,i,r,s,c,p,l,u,d,m,_,f,h,y,g,v){"use strict";function E(e){return void 0!==e.openOptionName}function N(e,t,n,o,i){return a.__awaiter(this,void 0,Promise,function(){var r,s;return a.__generator(this,function(a){switch(a.label){case 0:return r=function(){return o.then(function(e){return{redirect_url:i(e).toString()}})},[4,v.showLoadingPageAndDoRedirect(t,void 0,e,n.file_id,r,"width=800,height=600")];case 1:return s=a.sent(),[2,void 0!==s]}})})}function w(t,n){return a.__awaiter(this,void 0,Promise,function(){var o,i,r,s,c,p,l;return a.__generator(this,function(u){switch(u.label){case 0:return[4,new Promise(function(t,a){e(["modules/clean/api_v2/user_client"],t,a)}).then(a.__importStar)];case 1:o=u.sent().UserApiV2Client,i=new o,r={path:n.file_id},u.label=2;case 2:return u.trys.push([2,4,,5]),s={path:n.file_id,settings:{requested_visibility:{".tag":"public"}}},[4,i.ns("sharing").rpc("alpha/create_shared_link_with_settings",s,{subjectUserId:t.id})];case 3:return c=u.sent(),[2,c.url];case 4:if(p=u.sent(),!p.error||"shared_link_already_exists"!==p.error[".tag"])throw p;return[3,5];case 5:return[4,i.ns("sharing").rpc("list_shared_links",r,{subjectUserId:t.id})];case 6:if(l=u.sent(),0===l.links.length)throw new Error("Expected get result to contain at least one entry");return[2,l.links[0].url]}})})}function I(e,t){var a=o.filename(t.ns_path),n=w(e,t).then(function(e){return{subject:r._("%(file_name)s - Shared with Dropbox").format({file_name:a}),body:e}});return N(r._("Gmail"),e,t,n,D)}function O(e,t){var a=o.filename(t.ns_path),n=w(e,t).then(function(e){return{subject:r._("%(file_name)s - Shared with Dropbox").format({file_name:a}),body:e}});return N(r._("Outlook"),e,t,n,b)}function C(e,t){var a=o.filename(t.ns_path),n=w(e,t).then(function(e){return{subject:r._("%(file_name)s - Shared with Dropbox").format({file_name:a}),body:e}});return N(r._("WhatsApp"),e,t,n,S)}Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),o=a.__importStar(o);var x=[{entries:[{openOptionName:"unity"}]},{displayName:r._("Edit"),entries:[{openOptionName:"openWith"},{categoryId:u.Category.OPEN_WITH_CLOUD_DOC}]},{displayName:r._("Edit"),entries:[{categoryId:u.Category.PDF_EDITING}]},{displayName:r._("Edit"),entries:[{categoryId:u.Category.IMAGE_EDITING}]},{displayName:u.Category.getDisplayName(u.Category.VIDEO_EDITING),entries:[{categoryId:u.Category.VIDEO_EDITING}]},{displayName:r._("Copy to"),entries:[{openOptionName:"copyTo"}]},{displayName:u.Category.getDisplayName(u.Category.VIDEO_COMMENT),entries:[{categoryId:u.Category.VIDEO_COMMENT}]},{displayName:u.Category.getDisplayName(u.Category.VIEW_OR_EDIT),entries:[{categoryId:u.Category.VIEW_OR_EDIT}]},{displayName:u.Category.getDisplayName(u.Category.SEND_WITH),entries:[{openOptionName:"email"},{openOptionName:"share"},{categoryId:u.Category.SEND_WITH}]},{displayName:r._("Present"),entries:[{openOptionName:"present"}]},{displayName:u.Category.getDisplayName(u.Category.ESIGNATURE),entries:[{openOptionName:"esignature"},{categoryId:u.Category.ESIGNATURE}]},{displayName:u.Category.getDisplayName(u.Category.SEND_FAX),entries:[{categoryId:u.Category.SEND_FAX}]},{displayName:r._("Download"),entries:[{openOptionName:"download"}]},{displayName:r._("TESTING"),entries:[{categoryId:u.Category.DEFAULT}]}],A=(function(e){function t(t){var o=e.call(this,t)||this;return o.handleSentViaGmail=function(){return a.__awaiter(o,void 0,void 0,function(){var e,t,n,o;return a.__generator(this,function(a){switch(a.label){case 0:return e=this.props,t=e.user,n=e.file,this.logEvent("select_gmail_action",{}),[4,I(t,n)];case 1:return o=a.sent(),o?this.logEvent("select_gmail_action_success",{}):this.logEvent("select_gmail_action_failure",{}),[2]}})})},o.handleSendViaOutlook=function(){return a.__awaiter(o,void 0,void 0,function(){var e,t,n,o;return a.__generator(this,function(a){switch(a.label){case 0:return e=this.props,t=e.user,n=e.file,this.logEvent("select_outlook_action",{}),[4,O(t,n)];case 1:return o=a.sent(),o?this.logEvent("select_outlook_action_success",{}):this.logEvent("select_outlook_action_failure",{}),[2]}})})},o.handleSendViaWhatsApp=function(){return a.__awaiter(o,void 0,void 0,function(){var e,t,n,o;return a.__generator(this,function(a){switch(a.label){case 0:return e=this.props,t=e.user,n=e.file,[4,C(t,n)];case 1:return o=a.sent(),o?this.logEvent("select_whats_app_action_success",{}):this.logEvent("select_whats_app_action_failure",{}),[2]}})})},o.renderCategory=function(e){var t=o.props.extensionsConfig.featureFlags.expPersonalization,a="V2"===t,i=a&&e.description?n.default.createElement("div",{className:"app-action__category-subtitle"},e.description):null;return n.default.createElement(c.PopoverItemGroup,{className:"app-action-category-group",key:e.key},e.displayName?n.default.createElement(c.PopoverItemGroupTitle,{className:"app-action-category-title"},e.displayName):null,i,e.actions.map(function(e){return o.renderActionRow(e)}),n.default.createElement(c.PopoverItemGroupSeparator,{className:"app-action-menu-separator"}))},o.wrapperForAction=function(e,t,n){var i=o.props,r=i.file,s=i.user;return{handler:function(){return a.__awaiter(o,void 0,void 0,function(){return a.__generator(this,function(t){return d.redirectToAction(s,e.id,e.description,r.file_id),this.logEvent("select_action",{action_id:e.id,encoded_app_id:e.app_id}),[2]})})},userAction:y.UserAction.OpenWithAppAction,actionName:e.description}},o.handleImgLoadError=function(){o.props.refreshAppIcons&&o.props.refreshAppIcons({user:o.props.user})},o.renderActionRow=function(e){if(!o.isApiAppAction(e))return e;var t,a=o.props.appIcons[e.app_id];t=a.is_static?p.static_url("/static/images/generic_app_icon-vflIPYT1H.png"):a.url;var i=e.link_state[".tag"].indexOf("_linked")>=0,r=n.default.createElement(c.PopoverContentItem,{className:"app-action-row",key:e.id,value:o.wrapperForAction(e,t,i)},n.default.createElement("div",null,n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{className:"app-action-popover-icon",src:t,alt:"",onError:o.handleImgLoadError}),n.default.createElement("div",{className:"app-action-popover-item-info"},e.description))));return n.default.createElement(g.ExtensionsBylineTooltip,{bylines:o.props.extensionsConfig.bylines[e.app_id],onDidShow:o.handleShowByline(e.app_id)},r)},o.state={popoverContentPosition:"below",showTooltip:void 0},o}return a.__extends(t,e),t.prototype.includeDownloadInMenu=function(){return this.props.showAsButtonIfDownloadOnly},t.prototype.logEvent=function(e,t){this.props.currentSession&&this.props.currentSession.event(e,t)},t.prototype.getOpenOptionsWithLogging=function(e){var t=this;return e.map(function(e){return a.__assign({},e,{handler:function(){e.handler(),t.logEvent("select_legacy_action",{type:e.type})}})})},t.prototype.handleShowByline=function(e){var t=this;return function(){t.logEvent("show_byline",{extension_id:e})}},t.prototype.renderOpenOptions=function(e){var t=this,a=this.props.extensionsConfig.bylines,o=this.getOpenOptionsWithLogging(e),i=[],s=[],u=[],d=[],h=[],y=[],v=[],E=[];if(o.forEach(function(e){var o=e.type,E=o===l.OpenButtonAction.OPEN_IN_PAPER,N=o===l.OpenButtonAction.OPEN_WITH,w=o===l.OpenButtonAction.UNITY_FILE||o===l.OpenButtonAction.UNITY_FOLDER,I=o===l.OpenButtonAction.DOWNLOAD,O=o===l.OpenButtonAction.PREPARE_FOR_SIGNATURE,C=o===l.OpenButtonAction.SHARE_TO_SLACK,x=o===l.OpenButtonAction.PRESENT_IN_ZOOM;if(o===l.OpenButtonAction.OPEN_WITH_CLOUD_DOC)s.push(n.default.createElement(g.ExtensionsBylineTooltip,{bylines:a.cloud_doc,onDidShow:t.handleShowByline("cloud_doc")},n.default.createElement(c.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:e.text,src:e.iconUrl,className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))));else if(E&&e.spriteName)i.push(n.default.createElement(g.ExtensionsBylineTooltip,{bylines:a.paper,onDidShow:t.handleShowByline("paper")},n.default.createElement(c.PopoverContentItem,{className:"app-action-row",key:e.text,value:e},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:"",src:p.static_url("/static/images/paper/paper-icon-vfluG3iA1.png"),className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},r._("Paper"))))));else if((w||N)&&e.spriteName){var A=w?u:s,D=w?"unity":"wopi";A.push(n.default.createElement(g.ExtensionsBylineTooltip,{bylines:a[D],onDidShow:t.handleShowByline(D)},n.default.createElement(c.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement(m.Sprite,{group:"web",name:e.spriteName,alt:e.text,className:"app-action-popover-icon-sprite"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))))}else I&&t.includeDownloadInMenu()?d.push(n.default.createElement(c.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement(_.IconAction,{className:"app-action-popover-icon-svg",name:"download"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))):C?y.push(n.default.createElement(c.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:r._("Share to Slack"),src:p.static_url("/static/images/thirdparty/slack_icon-vflKvKltK.svg"),className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))):x?v.push(n.default.createElement(c.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:r._("Zoom"),src:p.static_url("/static/images/thirdparty/zoom_squircle-vflImll5V.svg"),className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))):O&&h.push(n.default.createElement(c.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement(f.IconDocument,{className:"app-action-popover-icon-svg",name:"signature-small"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},e.text))))}),"ON"===this.props.extensionsConfig.featureFlags.expGmailAction){var N={name:"gmail",handler:this.handleSentViaGmail};E.push(n.default.createElement(c.PopoverContentItem,{key:"gmail",value:N,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:"",src:p.static_url("/static/images/thirdparty/gmail_icon-vflugrKbt.png"),className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},r._("Gmail")))))}if("ON"===this.props.extensionsConfig.featureFlags.expWhatsAppAction){var N={name:"whatsapp",handler:this.handleSendViaWhatsApp};y.push(n.default.createElement(c.PopoverContentItem,{key:"whatsapp",value:N,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:"",src:p.static_url("/static/images/thirdparty/whats_app_icon-vflPumid4.png"),className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},r._("WhatsApp")))))}if("ON"===this.props.extensionsConfig.featureFlags.expOutlookAction){var N={name:"outlook",handler:this.handleSendViaOutlook};E.push(n.default.createElement(c.PopoverContentItem,{key:"outlook",value:N,className:"app-action-row"},n.default.createElement("div",{className:"app-action-row-content"},n.default.createElement("img",{alt:"",src:p.static_url("/static/images/thirdparty/outlook_icon-vflzzt-G0.svg"),className:"app-action-popover-icon"}),n.default.createElement("span",{className:"app-action-legacy-option-text"},r._("Outlook")))))}return{copyTo:i,openWith:s,unity:u,download:d,share:y,present:v,esignature:h,email:E}},t.prototype.renderActions=function(e){var t={};this.props.extensionsConfig.actionCategories.map(function(e){t[e.categoryId]=e});var a=[];x.map(function(n,o){for(var i=[],r=0,s=n.entries;r<s.length;r++){var c=s[r];E(c)?i.push.apply(i,e[c.openOptionName]):t[c.categoryId]&&i.push.apply(i,t[c.categoryId].actions)}i.length>0&&a.push({displayName:n.displayName,key:"category-"+o,actions:i})});var o=a.map(this.renderCategory);return n.default.createElement("div",null,o)},t.prototype.isApiAppAction=function(e){return void 0!==e.url},t.prototype.render=function(){var e=this.props.openOptions,t=this.renderOpenOptions(e);return this.renderActions(t)},t.defaultProps={showAsButtonIfDownloadOnly:!1,unityInfo:{}},t})(n.default.Component),D=function(e){return new i.URI({scheme:"https",authority:"mail.google.com",path:"/mail/",query:{view:"cm",fs:"1",su:e.subject,body:e.body}})},b=function(e){return new i.URI({scheme:"https",authority:"outlook.live.com",path:"/mail/deeplink/compose",query:{subject:e.subject,body:e.body,popoutv2:"1"}})},S=function(e){return new i.URI({scheme:"https",authority:"wa.me",path:"/",query:{text:e.body}})};t.ExtensionsPopoverContentWithUnity=function(e){return n.default.createElement(h.WithUnity,{file:e.file,user:e.user,render:function(t){return n.default.createElement(A,a.__assign({},e,{unityInfo:t}))}})},t.ExtensionsPopoverContentNoUnity=s.requireCssWithComponent(A,["/static/css/app_actions/index-vflHjobNJ.css"])});
//# sourceMappingURL=extensions_popover_content_component.min.js-vflpu76hq.map